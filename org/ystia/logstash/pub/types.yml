tosca_definitions_version: alien_dsl_1_4_0

metadata:
  template_name: org.ystia.logstash.pub
  template_version: 1.0-SNAPSHOT
  template_author: Bull

description: Public interface types for Logstash support.

imports:
  - tosca-normative-types:1.0.0-ALIEN14
  - org.ystia.common:1.0-SNAPSHOT
  - org.ystia.consul.pub:1.0-SNAPSHOT
  - org.ystia.java.pub:1.0-SNAPSHOT
  - org.ystia.kafka.pub:1.0-SNAPSHOT
  - org.ystia.elasticsearch.pub:1.0-SNAPSHOT

node_types:
  org.ystia.logstash.pub.nodes.Logstash:
    derived_from: org.ystia.consul.pub.nodes.ConsulUser
    abstract: true
    description: Main Logstash Component
    tags:
      icon: /images/logstash-icon.png
    properties:
      component_version:
        type: version
        description: Version of the installed Logstash component
        default: 5.1.1
        constraints:
          - valid_values: [5.1.1, 5.1.2, 5.2.2, 5.3.3, 5.4.3, 5.5.3, 5.6.2]
      repository:
         type: string
         description: >
           This property give the opportunity to specify an alternative download repository for this component artifact.
           It is your responsibility to provide an accessible download url and to store required artifacts on it.
           You should specify only the base repository url. Artifacts names will be appended to it, so this property could be shared among
           several components using the inputs feature.
         required: false
         default: https://artifacts.elastic.co/downloads/logstash
         constraints:
           - pattern: ^(http|https|ftp)://.+/.*$
      auto_reload:
        type: boolean
        description: Monitor configuration changes and reload whenever it is changed
        default: false
      reload_interval:
        type: integer
        description: How frequently to poll the configuration location for changes, in seconds
        default: 60
      stdout:
        type: boolean
        description: Define the stdout logstash output, to allow to see the events pipeline.
        default: false
      heap_size:
        type: string
        default: "1G"
        description: >
          This property allows to set the heap memory size that is allocated to Logstash java process,
          It allocates the same value to both initial and maximum values (ie -Xms and -Xmx java options).
        constraints:
          - pattern: "[1-9][0-9]*[kKmMgG]"
      log_level:
        type: string
        description: >
          Define Logstash log level. By default very few logs are generated by Logstash.
          All logs are redirected to a file except if you set 'stdout' to 'true'.
        default: "warn"
        constraints:
          - valid_values: [ "fatal", "error", "warn", "info", "debug", "trace" ]
    capabilities:
      logstash_resource:
        type: org.ystia.logstash.pub.capabilities.LogstashEndpoint
      connector_host:
        type: org.ystia.logstash.pub.capabilities.LogstashConnectorHosting
        occurrences: [0,unbounded]
    requirements:
      - host:
          capability: org.ystia.java.pub.capabilities.JavaHosting
          relationship: org.ystia.java.pub.relationships.HostedOnJavaRuntime
          occurrences: [1, 1]
  org.ystia.logstash.pub.nodes.GeoNames:
    derived_from: org.ystia.consul.pub.nodes.ConsulUser
    abstract: true
    description: GeoNames Component
    tags:
      icon: /images/geonames.gif
    properties:
      repository:
        type: string
        description: >
          The repository to download the geonames archives.
          You may want to specify a local directory where you have previously copied the archive files.
        required: false
        default: http://download.geonames.org/export/dump/
        constraints:
          - pattern: ^(http|https|ftp)://.+/.*$
      filename:
        type: string
        default: allCountries
        description: >
          Name of the file containing GeoNames data
          Choose allCountries to get a complete information (very heavy)
          You can choose a country code in capitals (US, FR, ...)
          Or another file like cities15000 or cities5000
          A .zip suffix will be added to this name.
        required: true
      indexname:
        type: string
        default: geonames
        description: >
          Name of index to store GeoNames data
        required: true
    capabilities:
      geonames_resource: org.ystia.logstash.pub.capabilities.GeonamesEndpoint
    requirements:
      - host:
          capability: org.ystia.logstash.pub.capabilities.LogstashConnectorHosting
          relationship: org.ystia.logstash.pub.relationships.GeonamesHostedOnLogstash
          occurrences: [1,1]

capability_types:
  org.ystia.logstash.pub.capabilities.LogstashEndpoint:
    derived_from: tosca.capabilities.Endpoint

  org.ystia.logstash.pub.capabilities.LogstashConnectorHosting:
    derived_from: tosca.capabilities.Container

  org.ystia.logstash.pub.capabilities.GeonamesEndpoint:
    derived_from: tosca.capabilities.Endpoint

relationship_types:
  org.ystia.logstash.pub.relationships.GeonamesHostedOnLogstash:
    derived_from: tosca.relationships.HostedOn