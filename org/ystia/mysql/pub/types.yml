tosca_definitions_version: alien_dsl_1_4_0

metadata:
  template_name: org.ystia.mysql.pub
  template_version: 1.0-SNAPSHOT
  template_author: Bull

description: Public interface types for MySql support.

imports:
  - tosca-normative-types:1.0.0-ALIEN14
  - org.ystia.common:1.0-SNAPSHOT

node_types:
  org.ystia.mysql.pub.nodes.MySQLServer:
    derived_from: org.ystia.nodes.DBMS
    abstract: true
    description: Install, configure and start a MySQL Server
    tags:
      icon: /images/mysql_server.jpg
    properties:
      root_password:
        type: string
        description: DBMS root password
        default: "mysql"
        required: false
      port:
        type: integer
        description: DBMS port
        default: 3306
        required: false
      component_version:
        type: version
        description: The optional MySQL componentâ€™s version.
        default: 5.6
        required: false
      mysql_community_repo:
        type: string
        required: false
        description: >
          This property give the opportunity to specify an alternative download repository for this component artifact.
          It is your responsibility to provide an accessible download url and to store required artifacts on it.
        default: http://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64
    capabilities:
      host:
        type: org.ystia.mysql.pub.capabilities.Container.MySQLServer

  org.ystia.mysql.pub.nodes.MySQLDatabase:
    derived_from: org.ystia.nodes.Database
    description: Create and configure a new database for MySQL
    abstract: true
    tags:
      icon: /images/mysql_db.jpg
    properties:
      name:
        type: string
        description: DataBase name
        required: true
        default: "Jack"
      user:
        type: string
        description: DataBase user
        required: true
        default: "mysql"
      password:
        type: string
        description: DataBase user password
        required: true
        default: "secret"
      port:
        type: integer
        description: DBMS port
        default: 3306
        required: true
    capabilities:
     mysql_db_endpoint:
        type: org.ystia.mysql.pub.capabilities.Endpoint.MySQLDatabase
        occurrences: [0, unbounded]
    requirements:
      - host:
          capability: org.ystia.mysql.pub.capabilities.Container.MySQLServer
          relationship: org.ystia.mysql.linux.sh.relationships.HostedOn.MySQLServer
          occurrences: [1,1]

relationship_types:
  org.ystia.mysql.linux.sh.relationships.HostedOn.MySQLServer:
    derived_from: tosca.relationships.HostedOn
    description: >
      This type represents a hosting relationship between MySQLServer and MySQLDataBase components
    valid_target_types: [ org.ystia.mysql.pub.capabilities.Container.MySQLServer ]
    
capability_types:
  org.ystia.mysql.pub.capabilities.Container.MySQLServer:
    derived_from: tosca.capabilities.Container
    description: MySQLServer can host MySQLDataBase components

  org.ystia.mysql.pub.capabilities.Endpoint.MySQLDatabase:
    derived_from: tosca.capabilities.Root
    description: MySQL endpoint
